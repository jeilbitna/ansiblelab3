---
  - name: git 과제
    hosts: centos
    gather_facts: true
    become: true

    tasks:
      - name: git 설치하기
        yum: 
          name: git
          state: present

      - name: curl 설치하기
        yum:
          name: curl
          state: present

      - name: httpd 설치하기
        yum:
          name: httpd
          state: present

      - name: httpd 시작하기
        service:
          name: httpd
          state: started
          enabled: yes

      - name: firewalld 비활성화
        service: 
          name: firewalld
          state: stopped
          enabled: no
        when: ansible_distribution == 'CentOS'

      - name: git clone 하기
        git:
          repo: https://github.com/jeilbitna/ansiblelab3.git
          dest: /srv/checkout
          version: master
          clone: yes
          update: no
        notify:
          - trigger1

      - name: 최신 변경 내용 pull하기
        git:
          repo: https://github.com/jeilbitna/ansiblelab3.git
          dest: /srv/checkout
          version: master
          clone: no
          update: yes

        notify:
          - trigger1

      - name: /var/www/html 로 복사하기
        synchronize:
          src: /srv/checkout/
          dest: /var/www/html/
 
        notify:
          - trigger1


    handlers:
      - name: trigger1
        service:
          name: httpd
          state: restarted
        register: resultd
        notify:
          result

      - name: result
        debug: 
          var: resultd
